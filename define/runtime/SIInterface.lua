-- ============================================================================================================================================
-- ============================================================================================================================================
-- ========== 使用说明 ========================================================================================================================
-- ============================================================================================================================================
-- ============================================================================================================================================

-- ======================================================================
-- [接口管理]
-- 用于管理各种外部接口
-- 由于 MOD 中的各种接口非常多 , 于是有了此功能
-- ======================================================================
-- [作用]
-- 对接口进行管理 , 可以方便的导出所有接口
-- ======================================================================

-- ============================================================================================================================================
-- ============================================================================================================================================
-- ========== 基础数据 ========================================================================================================================
-- ============================================================================================================================================
-- ============================================================================================================================================

---@class SIInterface : SIBaseClass
SIInterface =
{
	ID = "SIInterface" ,
	Code = "SIInterface" ,
	Show = "接口管理" ,
	InterfaceID = "SIInterface" ,
	Interfaces = {}
}

-- ============================================================================================================================================
-- ============================================================================================================================================
-- ========== 接口管理 ========================================================================================================================
-- ============================================================================================================================================
-- ============================================================================================================================================

-- ======================================================================<br>
-- 注册接口<br>
-- 接口最终会注册进 remote 中<br>
-- 参数的含义对应 remote.add_interface 函数<br>
-- ======================================================================<br>
---@param interfaceID string -- 接口 ID
---@param interfaceList table -- 接口列表
---@return SIInterface -- 自身
function SIInterface.Add( interfaceID , interfaceList )
	if not interfaceID then
		return CodeE( SIInterface , "注册接口时 , 接口 ID 不能为空" )
	end
	if not interfaceList or SITable.Size( interfaceList ) < 1 then
		return CodeE( SIInterface , "注册接口时 , 接口列表不能为空" )
	end
	if SIInterface.Interfaces[interfaceID] then
		return CodeE( SIInterface , "当前接口集合已经注册过了 , 接口集合的名称不能重复" )
	end
	SIInterface.Interfaces[interfaceID] = interfaceList
	remote.add_interface( interfaceID , interfaceList )
	return SIInterface
end

-- ======================================================================<br>
-- 把所有已经注册的接口整理成可以输出的字符串的形式<br>
-- 以表的形式<br>
-- ======================================================================<br>
---@return string -- 所有已经注册的接口整理成的字符串
function SIInterface.ConcatAllInterfaceAsTable()
	local output = {}
	for interfaceID , interfaceList in pairs( SIInterface.Interfaces ) do
		local interfaceIDOut = interfaceID:gsub( "-" , "_" )
		output[interfaceIDOut] =
		{
			ID = interfaceID
		}
		local interfaceListOut = output[interfaceIDOut]
		for interfaceName , interfaceFunction in pairs( interfaceList ) do
			local interfaceNameOut = interfaceName:gsub( "-" , "_" )
			interfaceListOut[interfaceNameOut] = interfaceName
		end
	end
	return SITable.TableToString( output )
end

-- ======================================================================<br>
-- 在日志文件中输出所有已经注册的接口<br>
-- 以表的形式<br>
-- ======================================================================<br>
function SIInterface.LogAllInterfaceAsTable()
	SIPrint.Log( SIInterface.ConcatAllInterfaceAsTable() )
end

-- ============================================================================================================================================
-- ============================================================================================================================================
-- ========== 添加信息接口 ====================================================================================================================
-- ============================================================================================================================================
-- ============================================================================================================================================

SIInterface.Add( SIInterface.InterfaceID ,
{
	-- 输出信息
	ConcatAllInterfaceAsTable = SIInterface.ConcatAllInterfaceAsTable ,
	LogAllInterfaceAsTable = SIInterface.LogAllInterfaceAsTable
} )